with time checking using WaitforSingleOject